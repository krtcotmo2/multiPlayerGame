<!DOCTYPE html>
<html>

<head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <title>World Championship Rock Paper Scissors Tournament</title>
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous">
     <link rel="stylesheet" href="./assets/css/reset.css">
     <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
     <div id="login" class="container">
          <h1>World Championship Rock Paper Scissors Tournament</h1>
          <form class="needs-validation" role="form" data-toggle="validator" novalidate="true">
               <div id="newUserSection">
                    <div class="form-group">
                         <label for="tboxName">Name</label>
                         <input type="text" class="form-control" id="tboxName" placeholder="Enter Name" required="required">
                         <div class="help-block with-errors"></div>
                    </div>
                    <div class="form-group">
                         <label for="tboxUserName">User ID</label>
                         <input type="text" class="form-control" id="tboxUserName" placeholder="User name" required="required"
                              data-error="Please enter your user name.">
                    </div>
               </div>
               <div id="loginSection">
                    <div class="form-group">
                         <label for="tboxLogIn">Enter Your Login ID</label>
                         <input type="text" class="form-control" id="tboxLogin" placeholder="Login ID" required="required">
                    </div>
               </div>
               <button type="submit" id="btnAdd" class="btn btn-primary">Submit</button><br />
               <button type="button" id="btnCreateID" class="btn btn-link pl-0">Create login</button>
          </form>
          <div id="curPlayerHeader">
               <h2></h2>
               <p>Rember to always log out before leaving the site.</p>
               <button role="button" class="">Logout</button>
          </div>
     </div>
     <div class="container col-12 mx-0 my-3 px-0" id="mainGame">
          <div class="row w-100 justify-content-around px-0 mx-0">
               <div class="card col-3 px-0" id="players">
                    <div class="card-header ">
                         Current Players
                    </div>
                    <div class="card-body"></div>
               </div>
               <div class="card col-5 px-0">
                    <div class="card-header">
                         Current Game
                         <button role="button" id="btnDirection" class="btn btn-secondary btnHide d-none">Toggle
                              Directions</button>
                    </div>
                    <div class="card-body d-none" id="gameCard">
                         <h3 class="text-center py-2">
                         </h3>
                         <div class="px-2 inst">
                              <p>You have 5 seconds to make your choice. If you do not make a choice, you wil
                                   automatically lose. If you log out or quit the game before the duel ends you
                                   will lose.</p>
                         </div>
                         <h1 class="text-center"><span id="timerSection" class="badge badge-primary">5</span></h1>
                         <div class="container d-flex my-4 justify-content-around">
                              <img class="optionImg" src="./assets/images/optRock.png" data-value="rock" />
                              <img class="optionImg" src="./assets/images/optPaper.png" data-value="paper" />
                              <img class="optionImg" src="./assets/images/optSci.png" data-value="scissors" />
                         </div>
                         <div class="gameResults d-none px-4 ">
                              <h2 class="text-center"></h2>
                              <p><span class="oppName"></span> chose <span class="oppChoice"></span></p>
                              <div class="row d-flex justify-content-around my-3">
                                   <button class="btnReplay">Play Again</button><button class="btnStopDuel">Call It
                                        Quits</button>
                              </div>
                         </div>
                         <div class="replaySection d-none px-4 my-3 ">
                              You have requested a rematch, your opponent has 10 seonds to reply. If they do not
                              respond, you will be returned bak to the main pool and you can challenge another player.
                         </div>
                         <div class="rematchResponse d-none px-4 my-3 ">
                              <p><span class="oppName"></span> has challenged you to a rematch.</p>
                              <div class="row d-flex justify-content-around my-3">
                                   <button class="btnAcceptRe">Accept Rematch</button><button class="btnDeclineRe">Call
                                        It Quits</button>
                              </div>
                         </div>
                    </div>
               </div>

               <div class="card col-3 px-0">
                    <div class="card-header" >
                         Leader Board
                    </div>
                    <div class="card-body" id="leaderBoard">
                    </div>
               </div>
          </div>
     </div>
     <div class="modal" tabindex="-1" role="dialog" id="mainModal">
          <div class="modal-dialog" role="document">
               <div class="modal-content">
                    <div class="modal-header">
                         <h5 class="modal-title">Modal title</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                         </button>
                    </div>
                    <div class="modal-body">
                         <p></p>
                    </div>
                    <div class="modal-footer challengebtns">
                         <button type="button" id="btnTakeChallenge" class="btn btn-primary">Accept the Challenge</button>
                         <button type="button" id="btnHideChallenge" class="btn btn-secondary">Hide like a Coward</button>
                    </div>
                    <div class="modal-footer forceLogout">
                         <p>By clicking the button below, you can force log out the account. Once you force out the account, you will be able to log in.</p>
                         <button type="button" id="btnForceOut" class="btn btn-primary">Force Logout</button>
                    </div>
               </div>
          </div>
     </div>

     <footer id="load">Firebase SDK Loading&hellip;</footer>

     <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
          crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
          crossorigin="anonymous"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
          crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/1000hz-bootstrap-validator/0.11.9/validator.min.js"></script>
     <script src="./assets/script/fsCalls.js"></script>
     <script src="./assets/script/game.js"></script>
     <script type="text/javascript" src="./assets/script/check_browser_close.js"></script>
     <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>

     <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
     <script>
          // Initialize Firebase
          var config = {
               apiKey: "AIzaSyBg0a8MH3XdOwQLGi8mQ9ntlpSy4NayCCY",
               authDomain: "rpsgame-e8e2a.firebaseapp.com",
               databaseURL: "https://rpsgame-e8e2a.firebaseio.com",
               projectId: "rpsgame-e8e2a",
               storageBucket: "rpsgame-e8e2a.appspot.com",
               messagingSenderId: "65208031151"
          };
          firebase.initializeApp(config);
     </script>

     <script>
          $(document).ready(function () {
               try {
                    let app = firebase.app();
                    let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
                    document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
                    const firestore = firebase.firestore();
                    const settings = { timestampsInSnapshots: true };
                    firestore.settings(settings);
               } catch (e) {
                    document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the debugger.';
               }
               fs.syncPlayers();
               fs.getLeaderboard();
               $("#btnCreateID").on("click", function () {
                    $("#loginSection").css("display", "none");
                    $(this).css("display", "none");
                    $("#newUserSection").css("display", "block");
               });
               $("#btnAdd").on("click", function (evt) {
                    evt.preventDefault();
                    if ($("#loginSection").css("display") == "none") {
                         //create user
                         fs.newUser($("#tboxName").val().trim(), $("#tboxUserName").val().trim().toLowerCase(), mainUser);
                    } else {
                         //load user
                         fs.getUserId($("#tboxLogin").val().trim().toLowerCase(), mainUser);
                    }
               });
               $("#curPlayerHeader button").on("click", function () {
                    fs.logOut(mainUser.userName, mainUser);
               });
               $("#btnTakeChallenge").on("click", function () {
                    fs.acceptChallenge();
               });
               $("#btnHideChallenge").on("click", function () {
                    fs.rejectChallenge();
               });
               $("#btnDirection").on("click", function (arg) {
                    $("#gameCard .inst").toggle();
                    localStorage.setItem("dirShown", $("#gameCard .inst").css("display") != "none");
               });
               $(document).on("mouseup", ".aPlayer", function (evt) {
                    fs.issueChallenge(mainUser, $(this).data("user"));
               });
               $(".btnReplay").on("click", function () {
                    $(".replaySection").removeClass("d-none");
                    $(this).parent().parent().addClass("d-none");
                    fs.challengeRematch();
               });
               $(".btnStopDuel").on("click", function () {
                    fs.removeDuel(mainUser, myOpp);
               });
               $(".btnDeclineRe").on("click", function () {
                    fs.removeDuel(mainUser, myOpp);
                   
               });
               $(".optionImg").on("click", function () {
                    $(".optionImg").removeClass("chosen");
                    $(this).addClass("chosen");
                    fs.setUserChoice(mainUser, $(this).data("value"));
               });
               $(".btnAcceptRe").on("click", function(){
                    fs.rematchAccpeted();
               })
               $("#btnForceOut").on("click", function(){
                    fs.logOut($("#tboxLogin").val(), mainUser, true);
                    $("#mainModal").modal("hide");
               });
          });
     </script>
</body>

</html>
